// Function to fetch and display detailed weather, slope, and landslide risk data
function fetchDetails(lat, lon) {
    const timestamps = getTimestamps();
    const weatherPromises = Object.entries(timestamps).map(([label, { start, end }]) =>
        fetchHourlyWeatherData(lat, lon, start, end)
            .then(totalRainfall => ({ label, totalRainfall }))
    );

    // Fetch slope data
    const slopePromise = fetchSlope(lat, lon);

    Promise.all([...weatherPromises, slopePromise]).then(results => {
        // Weather data
        const weatherData = results.slice(0, -1).map(data => `
            <strong>${data.label}</strong><br>
            Cumulative Rainfall: ${data.totalRainfall.toFixed(2)} mm<br><br>
        `).join('');
        document.getElementById('weather-data').innerHTML = weatherData;

        // Elevation and slope data
        const { elevation, slope } = results[results.length - 1];
        document.getElementById('elevation-data').innerHTML = `
            Elevation: ${elevation} meters<br>
            Slope: ${slope}%
        `;

        // Calculate total rainfall for 72 hours, 48 hours, and 24 hours
        const rainfall24 = results.find(data => data.label === '24 hours ago').totalRainfall;
        const rainfall48 = results.find(data => data.label === '48 hours ago').totalRainfall;
        const rainfall72 = results.find(data => data.label === '72 hours ago').totalRainfall;

        // Define Risk Levels Based on Rainfall and Slope
        let riskLevel;

        if (rainfall24 === 0 && rainfall48 === 0 && rainfall72 === 0) {
            // No rainfall, low risk regardless of slope
            riskLevel = 'Low Risk';
        } else if (rainfall24 > 0 && rainfall24 < 30) {
            // Moderate rainfall
            if (slope >= 30) {
                riskLevel = 'Moderate Risk';  // High slope + moderate rainfall = moderate risk
            } else if (slope >= 15 && slope < 30) {
                riskLevel = 'Moderate Risk';  // Moderate slope + moderate rainfall = moderate risk
            } else {
                riskLevel = 'Low Risk';  // Low slope + moderate rainfall = low risk
            }
        } else if (rainfall24 >= 30) {
            // Significant rainfall in 24 hours
            if (slope >= 30) {
                riskLevel = 'High Risk';  // High slope + high rainfall = high risk
            } else if (slope >= 15 && slope < 30) {
                riskLevel = 'Moderate Risk';  // Moderate slope + high rainfall = moderate risk
            } else {
                riskLevel = 'Moderate Risk';  // Low slope + high rainfall = moderate risk
            }
        } else {
            // Edge case: very high slope and significant rainfall over 48/72 hours
            if (rainfall72 >= 50 || rainfall48 >= 50) {
                riskLevel = 'High Risk';  // Large amount of rainfall + slope = high risk
            } else {
                riskLevel = 'Moderate Risk';
            }
        }

        document.getElementById('risk-level').innerHTML = `Landslide Risk: ${riskLevel}`;
    });
}
